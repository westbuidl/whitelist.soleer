"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.WebUsbTransport = void 0;
const tslib_1 = require("tslib");
const abstractApi_1 = require("./abstractApi");
const usb_1 = require("../api/usb");
const background_browser_1 = require("../sessions/background-browser");
class WebUsbTransport extends abstractApi_1.AbstractApiTransport {
    constructor({ messages, logger, sessionsBackgroundUrl }) {
        super({
            messages,
            api: new usb_1.UsbApi({
                usbInterface: navigator.usb,
                logger,
            }),
            logger,
        });
        this.name = 'WebUsbTransport';
        this.sessionsBackgroundUrl = sessionsBackgroundUrl;
    }
    init({ signal } = {}) {
        return this.scheduleAction(() => tslib_1.__awaiter(this, void 0, void 0, function* () {
            const { sessionsBackgroundUrl } = this;
            const { requestFn, registerBackgroundCallbacks } = yield (0, background_browser_1.initBackgroundInBrowser)(sessionsBackgroundUrl);
            this.sessionsClient.init({
                requestFn,
                registerBackgroundCallbacks,
            });
            const handshakeRes = yield this.sessionsClient.handshake();
            this.stopped = !handshakeRes.success;
            return handshakeRes;
        }), { signal });
    }
    listen() {
        this.api.listen();
        return super.listen();
    }
}
exports.WebUsbTransport = WebUsbTransport;
//# sourceMappingURL=webusb.browser.js.map